// Use chai assert like normal assert.
assert = chai.assert;

// Sinon library embedded :(
var sinon=function(){var samsam,formatio;(function(){function e(e,t,n){if(e=="samsam"){samsam=t()}else if(typeof n==="function"){formatio=n(samsam)}}e.amd={};(typeof e==="function"&&e.amd&&function(t){e("samsam",t)}||typeof module==="object"&&function(e){module.exports=e()}||function(e){this.samsam=e()})(function(){function n(e){var t=e;return typeof e==="number"&&e!==t}function r(t){return e.toString.call(t).split(/[ \]]/)[1]}function i(e){if(typeof e!=="object"||typeof e.length!=="number"||r(e)==="Array"){return false}if(typeof e.callee=="function"){return true}try{e[e.length]=6;delete e[e.length]}catch(t){return true}return false}function s(e){if(!e||e.nodeType!==1||!t){return false}try{e.appendChild(t);e.removeChild(t)}catch(n){return false}return true}function o(t){var n=[],r;for(r in t){if(e.hasOwnProperty.call(t,r)){n.push(r)}}return n}function u(e){return typeof e.getTime=="function"&&e.getTime()==e.valueOf()}function a(e){return e===0&&1/e===-Infinity}function f(e,t){if(e===t||n(e)&&n(t)){return e!==0||a(e)===a(t)}}function l(t,a){function v(e){if(typeof e==="object"&&e!==null&&!(e instanceof Boolean)&&!(e instanceof Date)&&!(e instanceof Number)&&!(e instanceof RegExp)&&!(e instanceof String)){return true}return false}function m(e,t){var n;for(n=0;n<e.length;n++){if(e[n]===t){return n}}return-1}var l=[],c=[],h=[],p=[],d={};return function g(t,a,y,b){var w=typeof t;var E=typeof a;if(t===a||n(t)||n(a)||t==null||a==null||w!=="object"||E!=="object"){return f(t,a)}if(s(t)||s(a)){return false}var S=u(t),x=u(a);if(S||x){if(!S||!x||t.getTime()!==a.getTime()){return false}}if(t instanceof RegExp&&a instanceof RegExp){if(t.toString()!==a.toString()){return false}}var T=r(t);var N=r(a);var C=o(t);var k=o(a);if(i(t)||i(a)){if(t.length!==a.length){return false}}else{if(w!==E||T!==N||C.length!==k.length){return false}}var L,A,O,M,_,D,P,H,B,j,F;for(A=0,O=C.length;A<O;A++){L=C[A];if(!e.hasOwnProperty.call(a,L)){return false}M=t[L];_=a[L];D=v(M);P=v(_);H=D?m(l,M):-1;B=P?m(c,_):-1;j=H!==-1?h[H]:y+"["+JSON.stringify(L)+"]";F=B!==-1?p[B]:b+"["+JSON.stringify(L)+"]";if(d[j+F]){return true}if(H===-1&&D){l.push(M);h.push(j)}if(B===-1&&P){c.push(_);p.push(F)}if(D&&P){d[j+F]=true}if(!g(M,_,j,F)){return false}}return true}(t,a,"$1","$2")}function h(e,t){if(t.length===0){return true}var n,r,i,s;for(n=0,r=e.length;n<r;++n){if(c(e[n],t[0])){for(i=0,s=t.length;i<s;++i){if(!c(e[n+i],t[i])){return false}}return true}}return false}var e=Object.prototype;var t=typeof document!=="undefined"&&document.createElement("div");var c;c=function p(e,t){if(t&&typeof t.test==="function"){return t.test(e)}if(typeof t==="function"){return t(e)===true}if(typeof t==="string"){t=t.toLowerCase();var n=typeof e==="string"||!!e;return n&&String(e).toLowerCase().indexOf(t)>=0}if(typeof t==="number"){return t===e}if(typeof t==="boolean"){return t===e}if(r(e)==="Array"&&r(t)==="Array"){return h(e,t)}if(t&&typeof t==="object"){var i;for(i in t){if(!p(e[i],t[i])){return false}}return true}throw new Error("Matcher was not a string, a number, a "+"function, a boolean or an object")};return{isArguments:i,isElement:s,isDate:u,isNegZero:a,identical:f,deepEqual:l,match:c,keys:o}});(typeof e==="function"&&e.amd&&function(t){e("formatio",["samsam"],t)}||typeof module==="object"&&function(e){module.exports=e(require("samsam"))}||function(e){this.formatio=e(this.samsam)})(function(e){function i(e){if(!e){return""}if(e.displayName){return e.displayName}if(e.name){return e.name}var t=e.toString().match(/function\s+([^\(]+)/m);return t&&t[1]||""}function s(e,n){var r=i(n&&n.constructor);var s=e.excludeConstructors||t.excludeConstructors||[];var o,u;for(o=0,u=s.length;o<u;++o){if(typeof s[o]==="string"&&s[o]===r){return""}else if(s[o].test&&s[o].test(r)){return""}}return r}function o(e,t){if(typeof e!=="object"){return false}var n,r;for(n=0,r=t.length;n<r;++n){if(t[n]===e){return true}}return false}function u(t,n,i,s){if(typeof n==="string"){var a=t.quoteStrings;var f=typeof a!=="boolean"||a;return i||f?'"'+n+'"':n}if(typeof n==="function"&&!(n instanceof RegExp)){return u.func(n)}i=i||[];if(o(n,i)){return"[Circular]"}if(Object.prototype.toString.call(n)==="[object Array]"){return u.array.call(t,n,i)}if(!n){return String(1/n===-Infinity?"-0":n)}if(e.isElement(n)){return u.element(n)}if(typeof n.toString==="function"&&n.toString!==Object.prototype.toString){return n.toString()}var l,c;for(l=0,c=r.length;l<c;l++){if(n===r[l].object){return r[l].value}}return u.object.call(t,n,i,s)}function a(e){for(var t in e){this[t]=e[t]}}var t={excludeConstructors:["Object",/^.$/],quoteStrings:true};var n=Object.prototype.hasOwnProperty;var r=[];if(typeof global!=="undefined"){r.push({object:global,value:"[object global]"})}if(typeof document!=="undefined"){r.push({object:document,value:"[object HTMLDocument]"})}if(typeof window!=="undefined"){r.push({object:window,value:"[object Window]"})}u.func=function(e){return"function "+i(e)+"() {}"};u.array=function(e,t){t=t||[];t.push(e);var n,r,i=[];for(n=0,r=e.length;n<r;++n){i.push(u(this,e[n],t))}return"["+i.join(", ")+"]"};u.object=function(t,n,r){n=n||[];n.push(t);r=r||0;var i=[],a=e.keys(t).sort();var f=3;var l,c,h,p,d;for(p=0,d=a.length;p<d;++p){l=a[p];h=t[l];if(o(h,n)){c="[Circular]"}else{c=u(this,h,n,r+2)}c=(/\s/.test(l)?'"'+l+'"':l)+": "+c;f+=c.length;i.push(c)}var v=s(this,t);var m=v?"["+v+"] ":"";var g="";for(p=0,d=r;p<d;++p){g+=" "}if(f+r>80){return m+"{\n  "+g+i.join(",\n  "+g)+"\n"+g+"}"}return m+"{ "+i.join(", ")+" }"};u.element=function(e){var t=e.tagName.toLowerCase();var n=e.attributes,r,i=[],s,o,u,a;for(o=0,u=n.length;o<u;++o){r=n.item(o);s=r.nodeName.toLowerCase().replace("html:","");a=r.nodeValue;if(s!=="contenteditable"||a!=="inherit"){if(!!a){i.push(s+'="'+a+'"')}}}var f="<"+t+(i.length>0?" ":"");var l=e.innerHTML;if(l.length>20){l=l.substr(0,20)+"[...]"}var c=f+i.join(" ")+">"+l+"</"+t+">";return c.replace(/ contentEditable="inherit"/,"")};a.prototype={functionName:i,configure:function(e){return new a(e)},constructorName:function(e){return s(this,e)},ascii:function(e,t,n){return u(this,e,t,n)}};return a.prototype})})();var sinon=function(){"use strict";function r(t,n,r){e=r.exports=t("./sinon/util/core");t("./sinon/extend");t("./sinon/typeOf");t("./sinon/times_in_words");t("./sinon/spy");t("./sinon/call");t("./sinon/behavior");t("./sinon/stub");t("./sinon/mock");t("./sinon/collection");t("./sinon/assert");t("./sinon/sandbox");t("./sinon/test");t("./sinon/test_case");t("./sinon/match");t("./sinon/format");t("./sinon/log_error")}var e;var t=typeof module!=="undefined"&&module.exports&&typeof require==="function";var n=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(n){define(r)}else if(t){r(require,module.exports,module);e=module.exports}else{e={}}return e}();(function(e){function r(e){var n=false;try{e.appendChild(t);n=t.parentNode==e}catch(r){return false}finally{try{e.removeChild(t)}catch(r){}}return n}function i(e){return t&&e&&e.nodeType===1&&r(e)}function s(e){return typeof e==="function"||!!(e&&e.constructor&&e.call&&e.apply)}function o(e){return typeof e==="number"&&isNaN(e)}function u(e,t){for(var r in t){if(!n.call(e,r)){e[r]=t[r]}}}function a(e){return typeof e==="function"&&typeof e.restore==="function"&&e.restore.sinon}function f(e){e.wrapMethod=function(t,r,i){if(!t){throw new TypeError("Should wrap property of object")}if(typeof i!="function"){throw new TypeError("Method wrapper should be function")}var o=t[r],a;if(!s(o)){a=new TypeError("Attempted to wrap "+typeof o+" property "+r+" as function")}else if(o.restore&&o.restore.sinon){a=new TypeError("Attempted to wrap "+r+" which is already wrapped")}else if(o.calledBefore){var f=!!o.returns?"stubbed":"spied on";a=new TypeError("Attempted to wrap "+r+" which is already "+f)}if(a){if(o&&o.stackTrace){a.stack+="\n--------------\n"+o.stackTrace}throw a}var l=t.hasOwnProperty?t.hasOwnProperty(r):n.call(t,r);t[r]=i;i.displayName=r;i.stackTrace=(new Error("Stack Trace for original")).stack;i.restore=function(){if(!l){delete t[r]}if(t[r]===i){t[r]=o}};i.restore.sinon=true;u(i,o);return i};e.create=function(t){var n=function(){};n.prototype=t;return new n};e.deepEqual=function t(n,r){if(e.match&&e.match.isMatcher(n)){return n.test(r)}if(typeof n!="object"||typeof r!="object"){if(o(n)&&o(r)){return true}else{return n===r}}if(i(n)||i(r)){return n===r}if(n===r){return true}if(n===null&&r!==null||n!==null&&r===null){return false}if(n instanceof RegExp&&r instanceof RegExp){return n.source===r.source&&n.global===r.global&&n.ignoreCase===r.ignoreCase&&n.multiline===r.multiline}var s=Object.prototype.toString.call(n);if(s!=Object.prototype.toString.call(r)){return false}if(s=="[object Date]"){return n.valueOf()===r.valueOf()}var u,a=0,f=0;if(s=="[object Array]"&&n.length!==r.length){return false}for(u in n){a+=1;if(!(u in r)){return false}if(!t(n[u],r[u])){return false}}for(u in r){f+=1}return a==f};e.functionName=function(t){var n=t.displayName||t.name;if(!n){var r=t.toString().match(/function ([^\s\(]+)/);n=r&&r[1]}return n};e.functionToString=function r(){if(this.getCall&&this.callCount){var e,t,n=this.callCount;while(n--){e=this.getCall(n).thisValue;for(t in e){if(e[t]===this){return t}}}}return this.displayName||"sinon fake"};e.getConfig=function(t){var n={};t=t||{};var r=e.defaultConfig;for(var i in r){if(r.hasOwnProperty(i)){n[i]=t.hasOwnProperty(i)?t[i]:r[i]}}return n};e.defaultConfig={injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true};e.timesInWords=function(t){return t==1&&"once"||t==2&&"twice"||t==3&&"thrice"||(t||0)+" times"};e.calledInOrder=function(e){for(var t=1,n=e.length;t<n;t++){if(!e[t-1].calledBefore(e[t])||!e[t].called){return false}}return true};e.orderByFirstCall=function(e){return e.sort(function(e,t){var n=e.getCall(0);var r=t.getCall(0);var i=n&&n.callId||-1;var s=r&&r.callId||-1;return i<s?-1:1})};e.createStubInstance=function(t){if(typeof t!=="function"){throw new TypeError("The constructor should be a function.")}return e.stub(e.create(t.prototype))};e.restore=function(e){if(e!==null&&typeof e==="object"){for(var t in e){if(a(e[t])){e[t].restore()}}}else if(a(e)){e.restore()}};return e}function h(e,t){f(t)}var t=typeof document!="undefined"&&document.createElement("div");var n=Object.prototype.hasOwnProperty;var l=typeof module!=="undefined"&&module.exports&&typeof require=="function";var c=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(c){define(h)}else if(l){h(require,module.exports)}else if(!e){return}else{f(e)}})(typeof sinon=="object"&&sinon||null);(function(e){function t(e){function n(e){var n=Array.prototype.slice.call(arguments,1),r,i,s;for(i=0;i<n.length;i++){r=n[i];for(s in r){if(r.hasOwnProperty(s)){e[s]=r[s]}}if(t&&r.hasOwnProperty("toString")&&r.toString!==e.toString){e.toString=r.toString}}return e}var t=function(){var e={constructor:function(){return"0"},toString:function(){return"1"},valueOf:function(){return"2"},toLocaleString:function(){return"3"},prototype:function(){return"4"},isPrototypeOf:function(){return"5"},propertyIsEnumerable:function(){return"6"},hasOwnProperty:function(){return"7"},length:function(){return"8"},unique:function(){return"9"}};var t=[];for(var n in e){t.push(e[n]())}return t.join("")!=="0123456789"}();e.extend=n;return e.extend}function n(e,n,r){var i=e("./util/core");r.exports=t(i)}var r=typeof module!=="undefined"&&module.exports&&typeof require=="function";var i=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(i){define(n)}else if(r){n(require,module.exports,module)}else if(!e){return}else{t(e)}})(typeof sinon=="object"&&sinon||null);(function(e){function t(e){function t(e){switch(e){case 1:return"once";case 2:return"twice";case 3:return"thrice";default:return(e||0)+" times"}}e.timesInWords=t;return e.timesInWords}function n(e,n,r){var i=e("./util/core");r.exports=t(i)}var r=typeof module!=="undefined"&&module.exports&&typeof require=="function";var i=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(i){define(n)}else if(r){n(require,module.exports,module)}else if(!e){return}else{t(e)}})(typeof sinon=="object"&&sinon||null);(function(e,t){function n(e){function t(e){if(e===null){return"null"}else if(e===undefined){return"undefined"}var t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLowerCase()}e.typeOf=t;return e.typeOf}function r(e,t,r){var i=e("./util/core");r.exports=n(i)}var i=typeof module!=="undefined"&&module.exports&&typeof require=="function";var s=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(s){define(r)}else if(i){r(require,module.exports,module)}else if(!e){return}else{n(e)}})(typeof sinon=="object"&&sinon||null,typeof formatio=="object"&&formatio);(function(e){function t(e){function t(t,n,r){var i=e.typeOf(t);if(i!==n){throw new TypeError("Expected type of "+r+" to be "+n+", but was "+i)}}function r(e){return n.isPrototypeOf(e)}function i(t,n){if(n===null||n===undefined){return false}for(var r in t){if(t.hasOwnProperty(r)){var o=t[r];var u=n[r];if(s.isMatcher(o)){if(!o.test(u)){return false}}else if(e.typeOf(o)==="object"){if(!i(o,u)){return false}}else if(!e.deepEqual(o,u)){return false}}}return true}function o(n,r){return function(i,o){t(i,"string","property");var u=arguments.length===1;var a=r+'("'+i+'"';if(!u){a+=", "+o}a+=")";return s(function(t){if(t===undefined||t===null||!n(t,i)){return false}return u||e.deepEqual(o,t[i])},a)}}var n={toString:function(){return this.message}};n.or=function(t){if(!arguments.length){throw new TypeError("Matcher expected")}else if(!r(t)){t=s(t)}var i=this;var o=e.create(n);o.test=function(e){return i.test(e)||t.test(e)};o.message=i.message+".or("+t.message+")";return o};n.and=function(t){if(!arguments.length){throw new TypeError("Matcher expected")}else if(!r(t)){t=s(t)}var i=this;var o=e.create(n);o.test=function(e){return i.test(e)&&t.test(e)};o.message=i.message+".and("+t.message+")";return o};var s=function(t,r){var s=e.create(n);var o=e.typeOf(t);switch(o){case"object":if(typeof t.test==="function"){s.test=function(e){return t.test(e)===true};s.message="match("+e.functionName(t.test)+")";return s}var u=[];for(var a in t){if(t.hasOwnProperty(a)){u.push(a+": "+t[a])}}s.test=function(e){return i(t,e)};s.message="match("+u.join(", ")+")";break;case"number":s.test=function(e){return t==e};break;case"string":s.test=function(e){if(typeof e!=="string"){return false}return e.indexOf(t)!==-1};s.message='match("'+t+'")';break;case"regexp":s.test=function(e){if(typeof e!=="string"){return false}return t.test(e)};break;case"function":s.test=t;if(r){s.message=r}else{s.message="match("+e.functionName(t)+")"}break;default:s.test=function(n){return e.deepEqual(t,n)}}if(!s.message){s.message="match("+t+")"}return s};s.isMatcher=r;s.any=s(function(){return true},"any");s.defined=s(function(e){return e!==null&&e!==undefined},"defined");s.truthy=s(function(e){return!!e},"truthy");s.falsy=s(function(e){return!e},"falsy");s.same=function(e){return s(function(t){return e===t},"same("+e+")")};s.typeOf=function(n){t(n,"string","type");return s(function(t){return e.typeOf(t)===n},'typeOf("'+n+'")')};s.instanceOf=function(n){t(n,"function","type");return s(function(e){return e instanceof n},"instanceOf("+e.functionName(n)+")")};s.has=o(function(e,t){if(typeof e==="object"){return t in e}return e[t]!==undefined},"has");s.hasOwn=o(function(e,t){return e.hasOwnProperty(t)},"hasOwn");s.bool=s.typeOf("boolean");s.number=s.typeOf("number");s.string=s.typeOf("string");s.object=s.typeOf("object");s.func=s.typeOf("function");s.array=s.typeOf("array");s.regexp=s.typeOf("regexp");s.date=s.typeOf("date");e.match=s;return s}function i(e,n,r){var i=e("./util/core");r.exports=t(i)}var n=typeof module!=="undefined"&&module.exports&&typeof require=="function";var r=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(r){define(i)}else if(n){i(require,module.exports,module)}else if(!e){return}else{t(e)}})(typeof sinon=="object"&&sinon||null);(function(e,t){function n(e){function n(e){return""+e}function r(){function n(){return e.ascii.apply(e,arguments)}var e=t.configure({quoteStrings:false,limitChildrenCount:250});return n}function i(e){function t(e){return typeof e=="object"&&e.toString===Object.prototype.toString?r.inspect(e):e}try{var r=require("util")}catch(i){}return r?t:n}var s=typeof module!=="undefined"&&module.exports&&typeof require=="function",o;if(s){try{t=require("formatio")}catch(u){}}if(t){o=r()}else if(s){o=i()}else{o=n}e.format=o;return e.format}function r(e,t,r){var i=e("./util/core");r.exports=n(i)}var i=typeof module!=="undefined"&&module.exports&&typeof require=="function";var s=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(s){define(r)}else if(i){r(require,module.exports,module)}else if(!e){return}else{n(e)}})(typeof sinon=="object"&&sinon||null,typeof formatio=="object"&&formatio);(function(e){function t(e){function t(t,r,i){var s=e.functionName(t)+r;if(i.length){s+=" Received ["+n.call(i).join(", ")+"]"}throw new Error(s)}function i(t,n,i,s,o,u){if(typeof u!=="number"){throw new TypeError("Call id is not a number")}var a=e.create(r);a.proxy=t;a.thisValue=n;a.args=i;a.returnValue=s;a.exception=o;a.callId=u;return a}var n=Array.prototype.slice;var r={calledOn:function(n){if(e.match&&e.match.isMatcher(n)){return n.test(this.thisValue)}return this.thisValue===n},calledWith:function(){for(var n=0,r=arguments.length;n<r;n+=1){if(!e.deepEqual(arguments[n],this.args[n])){return false}}return true},calledWithMatch:function(){for(var n=0,r=arguments.length;n<r;n+=1){var i=this.args[n];var s=arguments[n];if(!e.match||!e.match(s).test(i)){return false}}return true},calledWithExactly:function(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function(){return!this.calledWithMatch.apply(this,arguments)},returned:function(n){return e.deepEqual(n,this.returnValue)},threw:function(t){if(typeof t==="undefined"||!this.exception){return!!this.exception}return this.exception===t||this.exception.name===t},calledWithNew:function(){return this.proxy.prototype&&this.thisValue instanceof this.proxy},calledBefore:function(e){return this.callId<e.callId},calledAfter:function(e){return this.callId>e.callId},callArg:function(e){this.args[e]()},callArgOn:function(e,t){this.args[e].apply(t)},callArgWith:function(e){this.callArgOnWith.apply(this,[e,null].concat(n.call(arguments,1)))},callArgOnWith:function(e,t){var r=n.call(arguments,2);this.args[e].apply(t,r)},yield:function(){this.yieldOn.apply(this,[null].concat(n.call(arguments,0)))},yieldOn:function(e){var r=this.args;for(var i=0,s=r.length;i<s;++i){if(typeof r[i]==="function"){r[i].apply(e,n.call(arguments,1));return}}t(this.proxy," cannot yield since no callback was passed.",r)},yieldTo:function(e){this.yieldToOn.apply(this,[e,null].concat(n.call(arguments,1)))},yieldToOn:function(e,r){var i=this.args;for(var s=0,o=i.length;s<o;++s){if(i[s]&&typeof i[s][e]==="function"){i[s][e].apply(r,n.call(arguments,2));return}}t(this.proxy," cannot yield to '"+e+"' since no callback was passed.",i)},toString:function(){var t=this.proxy.toString()+"(";var n=[];for(var r=0,i=this.args.length;r<i;++r){n.push(e.format(this.args[r]))}t=t+n.join(", ")+")";if(typeof this.returnValue!="undefined"){t+=" => "+e.format(this.returnValue)}if(this.exception){t+=" !"+this.exception.name;if(this.exception.message){t+="("+this.exception.message+")"}}return t}};r.invokeCallback=r.yield;i.toString=r.toString;e.spyCall=i;return i}function i(e,n,r){var i=e("./util/core");e("./match");r.exports=t(i)}var n=typeof module!=="undefined"&&module.exports&&typeof require=="function";var r=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(r){define(i)}else if(n){i(require,module.exports,module)}else if(!e){return}else{t(e)}})(typeof sinon=="object"&&sinon||null);(function(sinon){function makeApi(sinon){function spy(e,t){if(!t&&typeof e=="function"){return spy.create(e)}if(!e&&!t){return spy.create(function(){})}var n=e[t];return sinon.wrapMethod(e,t,spy.create(n))}function matchingFake(e,t,n){if(!e){return}for(var r=0,i=e.length;r<i;r++){if(e[r].matches(t,n)){return e[r]}}}function incrementCallCount(){this.called=true;this.callCount+=1;this.notCalled=false;this.calledOnce=this.callCount==1;this.calledTwice=this.callCount==2;this.calledThrice=this.callCount==3}function createCallProperties(){this.firstCall=this.getCall(0);this.secondCall=this.getCall(1);this.thirdCall=this.getCall(2);this.lastCall=this.getCall(this.callCount-1)}function createProxy(func){var p;if(func.length){eval("p = (function proxy("+vars.substring(0,func.length*2-1)+") { return p.invoke(func, this, slice.call(arguments)); });")}else{p=function(){return p.invoke(func,this,slice.call(arguments))}}return p}function delegateToCalls(e,t,n,r){spyApi[e]=function(){if(!this.called){if(r){return r.apply(this,arguments)}return false}var i;var s=0;for(var o=0,u=this.callCount;o<u;o+=1){i=this.getCall(o);if(i[n||e].apply(i,arguments)){s+=1;if(t){return true}}}return s===this.callCount}}var push=Array.prototype.push;var slice=Array.prototype.slice;var callId=0;var vars="a,b,c,d,e,f,g,h,i,j,k,l";var uuid=0;var spyApi={reset:function(){if(this.invoking){var e=new Error("Cannot reset Sinon function while invoking it. "+"Move the call to .reset outside of the callback.");e.name="InvalidResetException";throw e}this.called=false;this.notCalled=true;this.calledOnce=false;this.calledTwice=false;this.calledThrice=false;this.callCount=0;this.firstCall=null;this.secondCall=null;this.thirdCall=null;this.lastCall=null;this.args=[];this.returnValues=[];this.thisValues=[];this.exceptions=[];this.callIds=[];if(this.fakes){for(var t=0;t<this.fakes.length;t++){this.fakes[t].reset()}}},create:function(t){var n;if(typeof t!="function"){t=function(){}}else{n=sinon.functionName(t)}var r=createProxy(t);sinon.extend(r,spy);delete r.create;sinon.extend(r,t);r.reset();r.prototype=t.prototype;r.displayName=n||"spy";r.toString=sinon.functionToString;r.instantiateFake=sinon.spy.create;r.id="spy#"+uuid++;return r},invoke:function(t,n,r){var i=matchingFake(this.fakes,r);var s,o;incrementCallCount.call(this);push.call(this.thisValues,n);push.call(this.args,r);push.call(this.callIds,callId++);createCallProperties.call(this);try{this.invoking=true;if(i){o=i.invoke(t,n,r)}else{o=(this.func||t).apply(n,r)}delete this.invoking;var u=this.getCall(this.callCount-1);if(u.calledWithNew()&&typeof o!=="object"){o=n}}catch(a){s=a}push.call(this.exceptions,s);push.call(this.returnValues,o);createCallProperties.call(this);if(s!==undefined){throw s}return o},named:function(t){this.displayName=t;return this},getCall:function(t){if(t<0||t>=this.callCount){return null}return sinon.spyCall(this,this.thisValues[t],this.args[t],this.returnValues[t],this.exceptions[t],this.callIds[t])},getCalls:function(){var e=[];var t;for(t=0;t<this.callCount;t++){e.push(this.getCall(t))}return e},calledBefore:function(t){if(!this.called){return false}if(!t.called){return true}return this.callIds[0]<t.callIds[t.callIds.length-1]},calledAfter:function(t){if(!this.called||!t.called){return false}return this.callIds[this.callCount-1]>t.callIds[t.callCount-1]},withArgs:function(){var e=slice.call(arguments);if(this.fakes){var t=matchingFake(this.fakes,e,true);if(t){return t}}else{this.fakes=[]}var n=this;var r=this.instantiateFake();r.matchingAguments=e;r.parent=this;push.call(this.fakes,r);r.withArgs=function(){return n.withArgs.apply(n,arguments)};for(var i=0;i<this.args.length;i++){if(r.matches(this.args[i])){incrementCallCount.call(r);push.call(r.thisValues,this.thisValues[i]);push.call(r.args,this.args[i]);push.call(r.returnValues,this.returnValues[i]);push.call(r.exceptions,this.exceptions[i]);push.call(r.callIds,this.callIds[i])}}createCallProperties.call(r);return r},matches:function(e,t){var n=this.matchingAguments;if(n.length<=e.length&&sinon.deepEqual(n,e.slice(0,n.length))){return!t||n.length==e.length}},printf:function(e){var t=this;var n=slice.call(arguments,1);var r;return(e||"").replace(/%(.)/g,function(e,i){r=spyApi.formatters[i];if(typeof r=="function"){return r.call(null,t,n)}else if(!isNaN(parseInt(i,10))){return sinon.format(n[i-1])}return"%"+i})}};delegateToCalls("calledOn",true);delegateToCalls("alwaysCalledOn",false,"calledOn");delegateToCalls("calledWith",true);delegateToCalls("calledWithMatch",true);delegateToCalls("alwaysCalledWith",false,"calledWith");delegateToCalls("alwaysCalledWithMatch",false,"calledWithMatch");delegateToCalls("calledWithExactly",true);delegateToCalls("alwaysCalledWithExactly",false,"calledWithExactly");delegateToCalls("neverCalledWith",false,"notCalledWith",function(){return true});delegateToCalls("neverCalledWithMatch",false,"notCalledWithMatch",function(){return true});delegateToCalls("threw",true);delegateToCalls("alwaysThrew",false,"threw");delegateToCalls("returned",true);delegateToCalls("alwaysReturned",false,"returned");delegateToCalls("calledWithNew",true);delegateToCalls("alwaysCalledWithNew",false,"calledWithNew");delegateToCalls("callArg",false,"callArgWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")});spyApi.callArgWith=spyApi.callArg;delegateToCalls("callArgOn",false,"callArgOnWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")});spyApi.callArgOnWith=spyApi.callArgOn;delegateToCalls("yield",false,"yield",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")});spyApi.invokeCallback=spyApi.yield;delegateToCalls("yieldOn",false,"yieldOn",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")});delegateToCalls("yieldTo",false,"yieldTo",function(e){throw new Error(this.toString()+" cannot yield to '"+e+"' since it was not yet invoked.")});delegateToCalls("yieldToOn",false,"yieldToOn",function(e){throw new Error(this.toString()+" cannot yield to '"+e+"' since it was not yet invoked.")});spyApi.formatters={c:function(e){return sinon.timesInWords(e.callCount)},n:function(e){return e.toString()},C:function(e){var t=[];for(var n=0,r=e.callCount;n<r;++n){var i="    "+e.getCall(n).toString();if(/\n/.test(t[n-1])){i="\n"+i}push.call(t,i)}return t.length>0?"\n"+t.join("\n"):""},t:function(e){var t=[];for(var n=0,r=e.callCount;n<r;++n){push.call(t,sinon.format(e.thisValues[n]))}return t.join(", ")},"*":function(e,t){var n=[];for(var r=0,i=t.length;r<i;++r){push.call(n,sinon.format(t[r]))}return n.join(", ")}};sinon.extend(spy,spyApi);spy.spyCall=sinon.spyCall;sinon.spy=spy;return spy}function loadDependencies(e,t,n){var r=e("./util/core");e("./call");n.exports=makeApi(r)}var isNode=typeof module!=="undefined"&&module.exports&&typeof require=="function";var isAMD=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module)}else if(!sinon){return}else{makeApi(sinon)}})(typeof sinon=="object"&&sinon||null);(function(e){function i(e,t){if(typeof e=="string"){this.exception=new Error(t||"");this.exception.name=e}else if(!e){this.exception=new Error("Error")}else{this.exception=e}return this}function s(e,t){var n=e.callArgAt;if(n<0){var r=e.callArgProp;for(var i=0,s=t.length;i<s;++i){if(!r&&typeof t[i]=="function"){return t[i]}if(r&&t[i]&&typeof t[i][r]=="function"){return t[i][r]}}return null}return t[n]}function o(e){function o(t,r,i){if(t.callArgAt<0){var s;if(t.callArgProp){s=e.functionName(t.stub)+" expected to yield to '"+t.callArgProp+"', but no object with such a property was passed."}else{s=e.functionName(t.stub)+" expected to yield, but no callback was passed."}if(i.length>0){s+=" Received ["+n.call(i,", ")+"]"}return s}return"argument at index "+t.callArgAt+" is not a function: "+r}function u(e,t){if(typeof e.callArgAt=="number"){var n=s(e,t);if(typeof n!="function"){throw new TypeError(o(e,n,t))}if(e.callbackAsync){r(function(){n.apply(e.callbackContext,e.callbackArguments)})}else{n.apply(e.callbackContext,e.callbackArguments)}}}var a={create:function(n){var r=e.extend({},e.behavior);delete r.create;r.stub=n;return r},isPresent:function(){return typeof this.callArgAt=="number"||this.exception||typeof this.returnArgAt=="number"||this.returnThis||this.returnValueDefined},invoke:function(t,n){u(this,n);if(this.exception){throw this.exception}else if(typeof this.returnArgAt=="number"){return n[this.returnArgAt]}else if(this.returnThis){return t}return this.returnValue},onCall:function(t){return this.stub.onCall(t)},onFirstCall:function(){return this.stub.onFirstCall()},onSecondCall:function(){return this.stub.onSecondCall()},onThirdCall:function(){return this.stub.onThirdCall()},withArgs:function(){throw new Error('Defining a stub by invoking "stub.onCall(...).withArgs(...)" is not supported. '+'Use "stub.withArgs(...).onCall(...)" to define sequential behavior for calls with certain arguments.')},callsArg:function(t){if(typeof t!="number"){throw new TypeError("argument index is not number")}this.callArgAt=t;this.callbackArguments=[];this.callbackContext=undefined;this.callArgProp=undefined;this.callbackAsync=false;return this},callsArgOn:function(t,n){if(typeof t!="number"){throw new TypeError("argument index is not number")}if(typeof n!="object"){throw new TypeError("argument context is not an object")}this.callArgAt=t;this.callbackArguments=[];this.callbackContext=n;this.callArgProp=undefined;this.callbackAsync=false;return this},callsArgWith:function(n){if(typeof n!="number"){throw new TypeError("argument index is not number")}this.callArgAt=n;this.callbackArguments=t.call(arguments,1);this.callbackContext=undefined;this.callArgProp=undefined;this.callbackAsync=false;return this},callsArgOnWith:function(n,r){if(typeof n!="number"){throw new TypeError("argument index is not number")}if(typeof r!="object"){throw new TypeError("argument context is not an object")}this.callArgAt=n;this.callbackArguments=t.call(arguments,2);this.callbackContext=r;this.callArgProp=undefined;this.callbackAsync=false;return this},yields:function(){this.callArgAt=-1;this.callbackArguments=t.call(arguments,0);this.callbackContext=undefined;this.callArgProp=undefined;this.callbackAsync=false;return this},yieldsOn:function(e){if(typeof e!="object"){throw new TypeError("argument context is not an object")}this.callArgAt=-1;this.callbackArguments=t.call(arguments,1);this.callbackContext=e;this.callArgProp=undefined;this.callbackAsync=false;return this},yieldsTo:function(e){this.callArgAt=-1;this.callbackArguments=t.call(arguments,1);this.callbackContext=undefined;this.callArgProp=e;this.callbackAsync=false;return this},yieldsToOn:function(e,n){if(typeof n!="object"){throw new TypeError("argument context is not an object")}this.callArgAt=-1;this.callbackArguments=t.call(arguments,2);this.callbackContext=n;this.callArgProp=e;this.callbackAsync=false;return this},"throws":i,throwsException:i,returns:function(t){this.returnValue=t;this.returnValueDefined=true;return this},returnsArg:function(t){if(typeof t!="number"){throw new TypeError("argument index is not number")}this.returnArgAt=t;return this},returnsThis:function(){this.returnThis=true;return this}};for(var f in a){if(a.hasOwnProperty(f)&&f.match(/^(callsArg|yields)/)&&!f.match(/Async/)){a[f+"Async"]=function(e){return function(){var t=this[e].apply(this,arguments);this.callbackAsync=true;return t}}(f)}}e.behavior=a;return a}function f(e,t,n){var r=e("./util/core");n.exports=o(r)}var t=Array.prototype.slice;var n=Array.prototype.join;var r=function(){if(typeof process==="object"&&typeof process.nextTick==="function"){return process.nextTick}else if(typeof setImmediate==="function"){return setImmediate}else{return function(e){setTimeout(e,0)}}}();var u=typeof module!=="undefined"&&module.exports&&typeof require=="function";var a=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(a){define(f)}else if(u){f(require,module.exports,module)}else if(!e){return}else{o(e)}})(typeof sinon=="object"&&sinon||null);(function(e){function t(e){function t(n,r,i){if(!!i&&typeof i!="function"){throw new TypeError("Custom stub should be function")}var s;if(i){s=e.spy&&e.spy.create?e.spy.create(i):i}else{s=t.create()}if(!n&&typeof r==="undefined"){return e.stub.create()}if(typeof r==="undefined"&&typeof n=="object"){for(var o in n){if(typeof n[o]==="function"){t(n,o)}}return n}return e.wrapMethod(n,r,s)}function n(t){return t.defaultBehavior||r(t)||e.behavior.create(t)}function r(e){return e.parent&&i(e.parent)}function i(e){var t=e.behaviors[e.callCount-1];return t&&t.isPresent()?t:n(e)}var s=0;var o={create:function(){var r=function(){return i(r).invoke(this,arguments)};r.id="stub#"+s++;var o=r;r=e.spy.create(r);r.func=o;e.extend(r,t);r.instantiateFake=e.stub.create;r.displayName="stub";r.toString=e.functionToString;r.defaultBehavior=null;r.behaviors=[];return r},resetBehavior:function(){var e;this.defaultBehavior=null;this.behaviors=[];delete this.returnValue;delete this.returnArgAt;this.returnThis=false;if(this.fakes){for(e=0;e<this.fakes.length;e++){this.fakes[e].resetBehavior()}}},onCall:function(n){if(!this.behaviors[n]){this.behaviors[n]=e.behavior.create(this)}return this.behaviors[n]},onFirstCall:function(){return this.onCall(0)},onSecondCall:function(){return this.onCall(1)},onThirdCall:function(){return this.onCall(2)}};for(var u in e.behavior){if(e.behavior.hasOwnProperty(u)&&!o.hasOwnProperty(u)&&u!="create"&&u!="withArgs"&&u!="invoke"){o[u]=function(t){return function(){this.defaultBehavior=this.defaultBehavior||e.behavior.create(this);this.defaultBehavior[t].apply(this.defaultBehavior,arguments);return this}}(u)}}e.extend(t,o);e.stub=t;return t}function i(e,n,r){var i=e("./util/core");e("./behavior");e("./spy");r.exports=t(i)}var n=typeof module!=="undefined"&&module.exports&&typeof require=="function";var r=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(r){define(i)}else if(n){i(require,module.exports,module)}else if(!e){return}else{t(e)}})(typeof sinon=="object"&&sinon||null);(function(e){function t(e){function r(t){if(!t){return e.expectation.create("Anonymous mock")}return r.create(t)}function i(e,t){if(!e){return}for(var n=0,r=e.length;n<r;n+=1){t(e[n])}}function u(e){if(e==0){return"never called"}else{return"called "+s(e)}}function a(e){var t=e.minCalls;var n=e.maxCalls;if(typeof t=="number"&&typeof n=="number"){var r=s(t);if(t!=n){r="at least "+r+" and at most "+s(n)}return r}if(typeof t=="number"){return"at least "+s(t)}return"at most "+s(n)}function f(e){var t=typeof e.minCalls=="number";return!t||e.callCount>=e.minCalls}function l(e){if(typeof e.maxCalls!="number"){return false}return e.callCount==e.maxCalls}function c(e,t){if(n&&n.isMatcher(e)){return e.test(t)}else{return true}}var t=[].push;var n=e.match;e.extend(r,{create:function(n){if(!n){throw new TypeError("object is null")}var i=e.extend({},r);i.object=n;delete i.create;return i},expects:function(r){if(!r){throw new TypeError("method is falsy")}if(!this.expectations){this.expectations={};this.proxies=[]}if(!this.expectations[r]){this.expectations[r]=[];var i=this;e.wrapMethod(this.object,r,function(){return i.invokeMethod(r,this,arguments)});t.call(this.proxies,r)}var s=e.expectation.create(r);t.call(this.expectations[r],s);return s},restore:function(){var t=this.object;i(this.proxies,function(e){if(typeof t[e].restore=="function"){t[e].restore()}})},verify:function(){var r=this.expectations||{};var s=[],o=[];i(this.proxies,function(e){i(r[e],function(e){if(!e.met()){t.call(s,e.toString())}else{t.call(o,e.toString())}})});this.restore();if(s.length>0){e.expectation.fail(s.concat(o).join("\n"))}else if(o.length>0){e.expectation.pass(s.concat(o).join("\n"))}return true},invokeMethod:function(r,i,s){var o=this.expectations&&this.expectations[r];var u=o&&o.length||0,a;for(a=0;a<u;a+=1){if(!o[a].met()&&o[a].allowsCall(i,s)){return o[a].apply(i,s)}}var f=[],l,c=0;for(a=0;a<u;a+=1){if(o[a].allowsCall(i,s)){l=l||o[a]}else{c+=1}t.call(f,"    "+o[a].toString())}if(c===0){return l.apply(i,s)}f.unshift("Unexpected call: "+e.spyCall.toString.call({proxy:r,args:s}));e.expectation.fail(f.join("\n"))}});var s=e.timesInWords;var o=Array.prototype.slice;e.expectation={minCalls:1,maxCalls:1,create:function(n){var r=e.extend(e.stub.create(),e.expectation);delete r.create;r.method=n;return r},invoke:function(n,r,i){this.verifyCallAllowed(r,i);return e.spy.invoke.apply(this,arguments)},atLeast:function(t){if(typeof t!="number"){throw new TypeError("'"+t+"' is not number")}if(!this.limitsSet){this.maxCalls=null;this.limitsSet=true}this.minCalls=t;return this},atMost:function(t){if(typeof t!="number"){throw new TypeError("'"+t+"' is not number")}if(!this.limitsSet){this.minCalls=null;this.limitsSet=true}this.maxCalls=t;return this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(t){if(typeof t!="number"){throw new TypeError("'"+t+"' is not a number")}this.atLeast(t);return this.atMost(t)},met:function(){return!this.failed&&f(this)},verifyCallAllowed:function(n,r){if(l(this)){this.failed=true;e.expectation.fail(this.method+" already called "+s(this.maxCalls))}if("expectedThis"in this&&this.expectedThis!==n){e.expectation.fail(this.method+" called with "+n+" as thisValue, expected "+this.expectedThis)}if(!("expectedArguments"in this)){return}if(!r){e.expectation.fail(this.method+" received no arguments, expected "+e.format(this.expectedArguments))}if(r.length<this.expectedArguments.length){e.expectation.fail(this.method+" received too few arguments ("+e.format(r)+"), expected "+e.format(this.expectedArguments))}if(this.expectsExactArgCount&&r.length!=this.expectedArguments.length){e.expectation.fail(this.method+" received too many arguments ("+e.format(r)+"), expected "+e.format(this.expectedArguments))}for(var i=0,o=this.expectedArguments.length;i<o;i+=1){if(!c(this.expectedArguments[i],r[i])){e.expectation.fail(this.method+" received wrong arguments "+e.format(r)+", didn't match "+this.expectedArguments.toString())}if(!e.deepEqual(this.expectedArguments[i],r[i])){e.expectation.fail(this.method+" received wrong arguments "+e.format(r)+", expected "+e.format(this.expectedArguments))}}},allowsCall:function(n,r){if(this.met()&&l(this)){return false}if("expectedThis"in this&&this.expectedThis!==n){return false}if(!("expectedArguments"in this)){return true}r=r||[];if(r.length<this.expectedArguments.length){return false}if(this.expectsExactArgCount&&r.length!=this.expectedArguments.length){return false}for(var i=0,s=this.expectedArguments.length;i<s;i+=1){if(!c(this.expectedArguments[i],r[i])){return false}if(!e.deepEqual(this.expectedArguments[i],r[i])){return false}}return true},withArgs:function(){this.expectedArguments=o.call(arguments);return this},withExactArgs:function(){this.withArgs.apply(this,arguments);this.expectsExactArgCount=true;return this},on:function(t){this.expectedThis=t;return this},toString:function(){var n=(this.expectedArguments||[]).slice();if(!this.expectsExactArgCount){t.call(n,"[...]")}var r=e.spyCall.toString.call({proxy:this.method||"anonymous mock expectation",args:n});var i=r.replace(", [...","[, ...")+" "+a(this);if(this.met()){return"Expectation met: "+i}return"Expected "+i+" ("+u(this.callCount)+")"},verify:function(){if(!this.met()){e.expectation.fail(this.toString())}else{e.expectation.pass(this.toString())}return true},pass:function(n){e.assert.pass(n)},fail:function(t){var n=new Error(t);n.name="ExpectationError";throw n}};e.mock=r;return r}function i(e,n,r){var i=e("./util/core");e("./call");e("./match");e("./spy");r.exports=t(i)}var n=typeof module!=="undefined"&&module.exports&&typeof require=="function";var r=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(r){define(i)}else if(n){i(require,module.exports,module)}else if(!e){return}else{t(e)}})(typeof sinon=="object"&&sinon||null);(function(e){function r(e){if(!e.fakes){e.fakes=[]}return e.fakes}function i(e,t){var n=r(e);for(var i=0,s=n.length;i<s;i+=1){if(typeof n[i][t]=="function"){n[i][t]()}}}function s(e){var t=r(e);var n=0;while(n<t.length){t.splice(n,1)}}function o(e){var o={verify:function(){i(this,"verify")},restore:function(){i(this,"restore");s(this)},reset:function(){i(this,"reset")},verifyAndRestore:function(){var t;try{this.verify()}catch(n){t=n}this.restore();if(t){throw t}},add:function(n){t.call(r(this),n);return n},spy:function(){return this.add(e.spy.apply(e,arguments))},stub:function(r,i,s){if(i){var o=r[i];if(typeof o!="function"){if(!n.call(r,i)){throw new TypeError("Cannot stub non-existent own property "+i)}r[i]=s;return this.add({restore:function(){r[i]=o}})}}if(!i&&!!r&&typeof r=="object"){var u=e.stub.apply(e,arguments);for(var a in u){if(typeof u[a]==="function"){this.add(u[a])}}return u}return this.add(e.stub.apply(e,arguments))},mock:function(){return this.add(e.mock.apply(e,arguments))},inject:function(t){var n=this;t.spy=function(){return n.spy.apply(n,arguments)};t.stub=function(){return n.stub.apply(n,arguments)};t.mock=function(){return n.mock.apply(n,arguments)};return t}};e.collection=o;return o}function f(e,t,n){var r=e("./util/core");e("./mock");e("./spy");e("./stub");n.exports=o(r)}var t=[].push;var n=Object.prototype.hasOwnProperty;var u=typeof module!=="undefined"&&module.exports&&typeof require=="function";var a=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(a){define(f)}else if(u){f(require,module.exports,module)}else if(!e){return}else{o(e)}})(typeof sinon=="object"&&sinon||null);if(typeof sinon=="undefined"){var sinon={}}(function(global){function addTimer(e,t){if(e.length===0){throw new Error("Function requires at least 1 parameter")}if(typeof e[0]==="undefined"){throw new Error("Callback must be provided to timer calls")}var n=id++;var r=e[1]||0;if(!this.timeouts){this.timeouts={}}this.timeouts[n]={id:n,func:e[0],callAt:this.now+r,invokeArgs:Array.prototype.slice.call(e,2)};if(t===true){this.timeouts[n].interval=r}if(addTimerReturnsObject){return{id:n,ref:function(){},unref:function(){}}}else{return n}}function parseTime(e){if(!e){return 0}var t=e.split(":");var n=t.length,r=n;var i=0,s;if(n>3||!/^(\d\d:){0,2}\d\d?$/.test(e)){throw new Error("tick only understands numbers and 'h:m:s'")}while(r--){s=parseInt(t[r],10);if(s>=60){throw new Error("Invalid time "+e)}i+=s*Math.pow(60,n-r-1)}return i*1e3}function createObject(e){var t;if(Object.create){t=Object.create(e)}else{var n=function(){};n.prototype=e;t=new n}t.Date.clock=t;return t}function mirrorDateProperties(e,t){if(t.now){e.now=function(){return e.clock.now}}else{delete e.now}if(t.toSource){e.toSource=function(){return t.toSource()}}else{delete e.toSource}e.toString=function r(){return t.toString()};e.prototype=t.prototype;e.parse=t.parse;e.UTC=t.UTC;e.prototype.toUTCString=t.prototype.toUTCString;for(var n in t){if(t.hasOwnProperty(n)){e[n]=t[n]}}return e}function restore(){var e;for(var t=0,n=this.methods.length;t<n;t++){e=this.methods[t];if(global[e].hadOwnProperty){global[e]=this["_"+e]}else{try{delete global[e]}catch(r){}}}this.methods=[]}function stubGlobal(e,t){t[e].hadOwnProperty=Object.prototype.hasOwnProperty.call(global,e);t["_"+e]=global[e];if(e=="Date"){var n=mirrorDateProperties(t[e],global[e]);global[e]=n}else{global[e]=function(){return t[e].apply(t,arguments)};for(var r in t[e]){if(t[e].hasOwnProperty(r)){global[e][r]=t[e][r]}}}global[e].clock=t}function makeApi(sinon){sinon.clock={now:0,create:function(t){var n=createObject(this);if(typeof t=="number"){n.now=t}if(!!t&&typeof t=="object"){throw new TypeError("now should be milliseconds since UNIX epoch")}return n},setTimeout:function(t,n){return addTimer.call(this,arguments,false)},clearTimeout:function(t){if(!t){return}if(!this.timeouts){this.timeouts=[]}if(typeof t==="object"){t=t.id}if(t in this.timeouts){delete this.timeouts[t]}},setInterval:function(t,n){return addTimer.call(this,arguments,true)},clearInterval:function(t){this.clearTimeout(t)},setImmediate:function(t){var n=Array.prototype.slice.call(arguments,1);return addTimer.call(this,[t,0].concat(n),false)},clearImmediate:function(t){this.clearTimeout(t)},tick:function(t){t=typeof t=="number"?t:parseTime(t);var n=this.now,r=this.now+t,i=this.now;var s=this.firstTimerInRange(n,r);var o;while(s&&n<=r){if(this.timeouts[s.id]){n=this.now=s.callAt;try{this.callTimer(s)}catch(u){o=o||u}}s=this.firstTimerInRange(i,r);i=n}this.now=r;if(o){throw o}return this.now},firstTimerInRange:function(e,t){var n,r=null,i;for(var s in this.timeouts){if(this.timeouts.hasOwnProperty(s)){if(this.timeouts[s].callAt<e||this.timeouts[s].callAt>t){continue}if(r===null||this.timeouts[s].callAt<r){i=this.timeouts[s];r=this.timeouts[s].callAt;n={func:this.timeouts[s].func,callAt:this.timeouts[s].callAt,interval:this.timeouts[s].interval,id:this.timeouts[s].id,invokeArgs:this.timeouts[s].invokeArgs}}}}return n||null},callTimer:function(timer){if(typeof timer.interval=="number"){this.timeouts[timer.id].callAt+=timer.interval}else{delete this.timeouts[timer.id]}try{if(typeof timer.func=="function"){timer.func.apply(null,timer.invokeArgs)}else{eval(timer.func)}}catch(e){var exception=e}if(!this.timeouts[timer.id]){if(exception){throw exception}return}if(exception){throw exception}},reset:function(){this.timeouts={}},Date:function(){function t(n,r,i,s,o,u,a){switch(arguments.length){case 0:return new e(t.clock.now);case 1:return new e(n);case 2:return new e(n,r);case 3:return new e(n,r,i);case 4:return new e(n,r,i,s);case 5:return new e(n,r,i,s,o);case 6:return new e(n,r,i,s,o,u);default:return new e(n,r,i,s,o,u,a)}}var e=Date;return mirrorDateProperties(t,e)}()};sinon.useFakeTimers=function(t){var n=sinon.clock.create(t);n.restore=restore;n.methods=Array.prototype.slice.call(arguments,typeof t=="number"?1:0);if(n.methods.length===0){n.methods=methods}for(var r=0,i=n.methods.length;r<i;r++){stubGlobal(n.methods[r],n)}return n};sinon.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:typeof setImmediate!=="undefined"?setImmediate:undefined,clearImmediate:typeof clearImmediate!=="undefined"?clearImmediate:undefined,setInterval:setInterval,clearInterval:clearInterval,Date:Date}}function loadDependencies(e,t,n){var r=e("./core");makeApi(r);n.exports=r}var timeoutResult=setTimeout(function(){},0);var addTimerReturnsObject=typeof timeoutResult==="object";clearTimeout(timeoutResult);var id=1;var methods=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];if(typeof global.setImmediate!=="undefined"){methods.push("setImmediate")}if(typeof global.clearImmediate!=="undefined"){methods.push("clearImmediate")}var isNode=typeof module!=="undefined"&&module.exports&&typeof require=="function";var isAMD=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module)}else{makeApi(sinon)}})(typeof global!="undefined"&&typeof global!=="function"?global:this);if(typeof sinon=="undefined"){this.sinon={}}(function(){function t(t){t.Event=function(t,n,r,i){this.initEvent(t,n,r,i)};t.Event.prototype={initEvent:function(e,t,n,r){this.type=e;this.bubbles=t;this.cancelable=n;this.target=r},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=true}};t.ProgressEvent=function(t,n,r){this.initEvent(t,false,false,r);this.loaded=n.loaded||null;this.total=n.total||null};t.ProgressEvent.prototype=new t.Event;t.ProgressEvent.prototype.constructor=t.ProgressEvent;t.CustomEvent=function(t,n,r){this.initEvent(t,false,false,r);this.detail=n.detail||null};t.CustomEvent.prototype=new t.Event;t.CustomEvent.prototype.constructor=t.CustomEvent;t.EventTarget={addEventListener:function(n,r){this.eventListeners=this.eventListeners||{};this.eventListeners[n]=this.eventListeners[n]||[];e.call(this.eventListeners[n],r)},removeEventListener:function(t,n){var r=this.eventListeners&&this.eventListeners[t]||[];for(var i=0,s=r.length;i<s;++i){if(r[i]==n){return r.splice(i,1)}}},dispatchEvent:function(t){var n=t.type;var r=this.eventListeners&&this.eventListeners[n]||[];for(var i=0;i<r.length;i++){if(typeof r[i]=="function"){r[i].call(this,t)}else{r[i].handleEvent(t)}}return!!t.defaultPrevented}}}function i(e){var n=e("./core");t(n)}var e=[].push;var n=typeof module!=="undefined"&&module.exports&&typeof require=="function";var r=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(r){define(i)}else if(n){i(require)}else{t(sinon)}})();(function(e){function s(){function n(t){e.addEventListener(t,function(n){var r=e["on"+t];if(r&&typeof r=="function"){r.call(this,n)}})}this.readyState=s.UNSENT;this.requestHeaders={};this.requestBody=null;this.status=0;this.statusText="";this.upload=new o;if(r.supportsCORS){this.withCredentials=false}var e=this;var t=["loadstart","load","abort","loadend"];for(var i=t.length-1;i>=0;i--){n(t[i])}if(typeof s.onCreate=="function"){s.onCreate(this)}}function o(){this.eventListeners={progress:[],load:[],abort:[],error:[]}}function u(e){if(e.readyState!==s.OPENED){throw new Error("INVALID_STATE_ERR")}if(e.sendFlag){throw new Error("INVALID_STATE_ERR")}}function a(e,t){t=t.toLowerCase();for(var n in e){if(n.toLowerCase()==t){return n}}return null}function f(e,t){if(!e){return}for(var n=0,r=e.length;n<r;n+=1){t(e[n])}}function l(e,t){for(var n=0;n<e.length;n++){if(t(e[n])===true){return true}}return false}function p(e){if(e.readyState!=s.OPENED){throw new Error("INVALID_STATE_ERR - "+e.readyState)}}function d(e){if(e.readyState==s.DONE){throw new Error("Request done")}}function v(e){if(e.async&&e.readyState!=s.HEADERS_RECEIVED){throw new Error("No headers received")}}function m(e){if(typeof e!="string"){var t=new Error("Attempted to respond to fake XMLHttpRequest with "+e+", which is not a string.");t.name="InvalidBodyException";throw t}}function g(o){o.xhr=r;o.extend(s.prototype,o.EventTarget,{async:true,open:function(t,n,r,i,o){this.method=t;this.url=n;this.async=typeof r=="boolean"?r:true;this.username=i;this.password=o;this.responseText=null;this.responseXML=null;this.requestHeaders={};this.sendFlag=false;if(s.useFilters===true){var u=arguments;var a=l(s.filters,function(e){return e.apply(this,u)});if(a){return s.defake(this,arguments)}}this.readyStateChange(s.OPENED)},readyStateChange:function(n){this.readyState=n;if(typeof this.onreadystatechange=="function"){try{this.onreadystatechange()}catch(r){o.logError("Fake XHR onreadystatechange handler",r)}}this.dispatchEvent(new o.Event("readystatechange"));switch(this.readyState){case s.DONE:this.dispatchEvent(new o.Event("load",false,false,this));this.dispatchEvent(new o.Event("loadend",false,false,this));this.upload.dispatchEvent(new o.Event("load",false,false,this));if(t){this.upload.dispatchEvent(new o.ProgressEvent("progress",{loaded:100,total:100}))}break}},setRequestHeader:function(t,n){u(this);if(i[t]||/^(Sec-|Proxy-)/.test(t)){throw new Error('Refused to set unsafe header "'+t+'"')}if(this.requestHeaders[t]){this.requestHeaders[t]+=","+n}else{this.requestHeaders[t]=n}},setResponseHeaders:function(t){p(this);this.responseHeaders={};for(var n in t){if(t.hasOwnProperty(n)){this.responseHeaders[n]=t[n]}}if(this.async){this.readyStateChange(s.HEADERS_RECEIVED)}else{this.readyState=s.HEADERS_RECEIVED}},send:function(t){u(this);if(!/^(get|head)$/i.test(this.method)){var n=a(this.requestHeaders,"Content-Type");if(this.requestHeaders[n]){var r=this.requestHeaders[n].split(";");this.requestHeaders[n]=r[0]+";charset=utf-8"}else{this.requestHeaders["Content-Type"]="text/plain;charset=utf-8"}this.requestBody=t}this.errorFlag=false;this.sendFlag=this.async;this.readyStateChange(s.OPENED);if(typeof this.onSend=="function"){this.onSend(this)}this.dispatchEvent(new o.Event("loadstart",false,false,this))},abort:function(){this.aborted=true;this.responseText=null;this.errorFlag=true;this.requestHeaders={};if(this.readyState>s.UNSENT&&this.sendFlag){this.readyStateChange(s.DONE);this.sendFlag=false}this.readyState=s.UNSENT;this.dispatchEvent(new o.Event("abort",false,false,this));this.upload.dispatchEvent(new o.Event("abort",false,false,this));if(typeof this.onerror==="function"){this.onerror()}},getResponseHeader:function(t){if(this.readyState<s.HEADERS_RECEIVED){return null}if(/^Set-Cookie2?$/i.test(t)){return null}t=a(this.responseHeaders,t);return this.responseHeaders[t]||null},getAllResponseHeaders:function(){if(this.readyState<s.HEADERS_RECEIVED){return""}var t="";for(var n in this.responseHeaders){if(this.responseHeaders.hasOwnProperty(n)&&!/^Set-Cookie2?$/i.test(n)){t+=n+": "+this.responseHeaders[n]+"\r\n"}}return t},setResponseBody:function(t){d(this);v(this);m(t);var n=this.chunkSize||10;var r=0;this.responseText="";do{if(this.async){this.readyStateChange(s.LOADING)}this.responseText+=t.substring(r,r+n);r+=n}while(r<t.length);var i=this.getResponseHeader("Content-Type");if(this.responseText&&(!i||/(text\/xml)|(application\/xml)|(\+xml)/.test(i))){try{this.responseXML=s.parseXML(this.responseText)}catch(o){}}this.readyStateChange(s.DONE)},respond:function(t,n,r){this.status=typeof t=="number"?t:200;this.statusText=s.statusCodes[this.status];this.setResponseHeaders(n||{});this.setResponseBody(r||"")},uploadProgress:function(n){if(t){this.upload.dispatchEvent(new o.ProgressEvent("progress",n))}},uploadError:function(t){if(n){this.upload.dispatchEvent(new o.CustomEvent("error",{detail:t}))}}});o.extend(s,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});o.useFakeXMLHttpRequest=function(){s.restore=function(n){if(r.supportsXHR){e.XMLHttpRequest=r.GlobalXMLHttpRequest}if(r.supportsActiveX){e.ActiveXObject=r.GlobalActiveXObject}delete s.restore;if(n!==true){delete s.onCreate}};if(r.supportsXHR){e.XMLHttpRequest=s}if(r.supportsActiveX){e.ActiveXObject=function(t){if(t=="Microsoft.XMLHTTP"||/^Msxml2\.XMLHTTP/i.test(t)){return new s}return new r.GlobalActiveXObject(t)}}return s};o.FakeXMLHttpRequest=s}function w(e,t,n){var r=e("./core");e("./event");g(r);n.exports=r}var t=typeof ProgressEvent!=="undefined";var n=typeof CustomEvent!=="undefined";var r={XMLHttpRequest:e.XMLHttpRequest};r.GlobalXMLHttpRequest=e.XMLHttpRequest;r.GlobalActiveXObject=e.ActiveXObject;r.supportsActiveX=typeof r.GlobalActiveXObject!="undefined";r.supportsXHR=typeof r.GlobalXMLHttpRequest!="undefined";r.workingXHR=r.supportsXHR?r.GlobalXMLHttpRequest:r.supportsActiveX?function(){return new r.GlobalActiveXObject("MSXML2.XMLHTTP.3.0")}:false;r.supportsCORS=r.supportsXHR&&"withCredentials"in new r.GlobalXMLHttpRequest;var i={"Accept-Charset":true,"Accept-Encoding":true,Connection:true,"Content-Length":true,Cookie:true,Cookie2:true,"Content-Transfer-Encoding":true,Date:true,Expect:true,Host:true,"Keep-Alive":true,Referer:true,TE:true,Trailer:true,"Transfer-Encoding":true,Upgrade:true,"User-Agent":true,Via:true};o.prototype.addEventListener=function(t,n){this.eventListeners[t].push(n)};o.prototype.removeEventListener=function(t,n){var r=this.eventListeners[t]||[];for(var i=0,s=r.length;i<s;++i){if(r[i]==n){return r.splice(i,1)}}};o.prototype.dispatchEvent=function(t){var n=this.eventListeners[t.type]||[];for(var r=0,i;(i=n[r])!=null;r++){i(t)}};var c=function(e,t,n){switch(n.length){case 0:return e[t]();case 1:return e[t](n[0]);case 2:return e[t](n[0],n[1]);case 3:return e[t](n[0],n[1],n[2]);case 4:return e[t](n[0],n[1],n[2],n[3]);case 5:return e[t](n[0],n[1],n[2],n[3],n[4])}};s.filters=[];s.addFilter=function(t){this.filters.push(t)};var h=/MSIE 6/;s.defake=function(t,n){var i=new r.workingXHR;f(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(e){t[e]=function(){return c(i,e,arguments)}});var o=function(e){f(e,function(e){try{t[e]=i[e]}catch(n){if(!h.test(navigator.userAgent)){throw n}}})};var u=function(){t.readyState=i.readyState;if(i.readyState>=s.HEADERS_RECEIVED){o(["status","statusText"])}if(i.readyState>=s.LOADING){o(["responseText","response"])}if(i.readyState===s.DONE){o(["responseXML"])}if(t.onreadystatechange){t.onreadystatechange.call(t,{target:t})}};if(i.addEventListener){for(var a in t.eventListeners){if(t.eventListeners.hasOwnProperty(a)){f(t.eventListeners[a],function(e){i.addEventListener(a,e)})}}i.addEventListener("readystatechange",u)}else{i.onreadystatechange=u}c(i,"open",n)};s.useFilters=false;s.parseXML=function(t){var n;if(typeof DOMParser!="undefined"){var r=new DOMParser;n=r.parseFromString(t,"text/xml")}else{n=new ActiveXObject("Microsoft.XMLDOM");n.async="false";n.loadXML(t)}return n};s.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};var y=typeof module!=="undefined"&&module.exports&&typeof require=="function";var b=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(b){define(w)}else if(y){w(require,module.exports,module)}else if(typeof sinon==="undefined"){return}else{g(sinon)}})(typeof self!=="undefined"?self:this);if(typeof sinon=="undefined"){var sinon={}}(function(){function t(){}function n(e){t.prototype=e;return new t}function r(e){var t=e;if(Object.prototype.toString.call(e)!="[object Array]"){t=[200,{},e]}if(typeof t[2]!="string"){throw new TypeError("Fake server response body should be string, but was "+typeof t[2])}return t}function o(e,t,n){var r=e.method;var i=!r||r.toLowerCase()==t.toLowerCase();var s=e.url;var o=!s||s==n||typeof s.test=="function"&&s.test(n);return i&&o}function u(e,t){var n=t.url;if(!/^https?:\/\//.test(n)||s.test(n)){n=n.replace(s,"")}if(o(e,this.getHTTPMethod(t),n)){if(typeof e.response=="function"){var r=e.url;var i=[t].concat(r&&typeof r.exec=="function"?r.exec(n).slice(1):[]);return e.response.apply(e,i)}return true}return false}function a(t){t.fakeServer={create:function(){var e=n(this);this.xhr=t.useFakeXMLHttpRequest();e.requests=[];this.xhr.onCreate=function(t){e.addRequest(t)};return e},addRequest:function(n){var r=this;e.call(this.requests,n);n.onSend=function(){r.handleRequest(this);if(r.autoRespond&&!r.responding){setTimeout(function(){r.responding=false;r.respond()},r.autoRespondAfter||10);r.responding=true}}},getHTTPMethod:function(t){if(this.fakeHTTPMethods&&/post/i.test(t.method)){var n=(t.requestBody||"").match(/_method=([^\b;]+)/);return!!n?n[1]:t.method}return t.method},handleRequest:function(n){if(n.async){if(!this.queue){this.queue=[]}e.call(this.queue,n)}else{this.processRequest(n)}},log:function(n,r){var i;i="Request:\n"+t.format(r)+"\n\n";i+="Response:\n"+t.format(n)+"\n\n";t.log(i)},respondWith:function(n,i,s){if(arguments.length==1&&typeof n!="function"){this.response=r(n);return}if(!this.responses){this.responses=[]}if(arguments.length==1){s=n;i=n=null}if(arguments.length==2){s=i;i=n;n=null}e.call(this.responses,{method:n,url:i,response:typeof s=="function"?s:r(s)})},respond:function(){if(arguments.length>0){this.respondWith.apply(this,arguments)}var t=this.queue||[];var n=t.splice(0,t.length);var r;while(r=n.shift()){this.processRequest(r)}},processRequest:function(n){try{if(n.aborted){return}var r=this.response||[404,{},""];if(this.responses){for(var i=this.responses.length,s=i-1;s>=0;s--){if(u.call(this,this.responses[s],n)){r=this.responses[s].response;break}}}if(n.readyState!=4){t.fakeServer.log(r,n);n.respond(r[0],r[1],r[2])}}catch(o){t.logError("Fake server request processing",o)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}function c(e,t,n){var r=e("./core");e("./fake_xml_http_request");a(r);n.exports=r}var e=[].push;var i=typeof window!=="undefined"?window.location:{};var s=new RegExp("^"+i.protocol+"//"+i.host);var f=typeof module!=="undefined"&&module.exports&&typeof require=="function";var l=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(l){define(c)}else if(f){c(require,module.exports,module)}else{a(sinon)}})();(function(){function e(e){function t(){}t.prototype=e.fakeServer;e.fakeServerWithClock=new t;e.fakeServerWithClock.addRequest=function(n){if(n.async){if(typeof setTimeout.clock=="object"){this.clock=setTimeout.clock}else{this.clock=e.useFakeTimers();this.resetClock=true}if(!this.longestTimeout){var r=this.clock.setTimeout;var i=this.clock.setInterval;var s=this;this.clock.setTimeout=function(e,t){s.longestTimeout=Math.max(t,s.longestTimeout||0);return r.apply(this,arguments)};this.clock.setInterval=function(e,t){s.longestTimeout=Math.max(t,s.longestTimeout||0);return i.apply(this,arguments)}}}return e.fakeServer.addRequest.call(this,n)};e.fakeServerWithClock.respond=function(){var n=e.fakeServer.respond.apply(this,arguments);if(this.clock){this.clock.tick(this.longestTimeout||0);this.longestTimeout=0;if(this.resetClock){this.clock.restore();this.resetClock=false}}return n};e.fakeServerWithClock.restore=function(){if(this.clock){this.clock.restore()}return e.fakeServer.restore.apply(this,arguments)}}function r(t){var n=t("./core");t("./fake_server");t("./fake_timers");e(n)}var t=typeof module!=="undefined"&&module.exports&&typeof require=="function";var n=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(n){define(r)}else if(t){r(require)}else{e(sinon)}})();(function(){function e(e){function n(e,n,r,i){if(!i){return}if(n.injectInto&&!(r in n.injectInto)){n.injectInto[r]=i;e.injectedKeys.push(r)}else{t.call(e.args,i)}}function r(t){var n=e.create(e.sandbox);if(t.useFakeServer){if(typeof t.useFakeServer=="object"){n.serverPrototype=t.useFakeServer}n.useFakeServer()}if(t.useFakeTimers){if(typeof t.useFakeTimers=="object"){n.useFakeTimers.apply(n,t.useFakeTimers)}else{n.useFakeTimers()}}return n}var t=[].push;e.sandbox=e.extend(e.create(e.collection),{useFakeTimers:function(){this.clock=e.useFakeTimers.apply(e,arguments);return this.add(this.clock)},serverPrototype:e.fakeServer,useFakeServer:function(){var n=this.serverPrototype||e.fakeServer;if(!n||!n.create){return null}this.server=n.create();return this.add(this.server)},inject:function(t){e.collection.inject.call(this,t);if(this.clock){t.clock=this.clock}if(this.server){t.server=this.server;t.requests=this.server.requests}return t},restore:function(){e.collection.restore.apply(this,arguments);this.restoreContext()},restoreContext:function(){if(this.injectedKeys){for(var e=0,t=this.injectedKeys.length;e<t;e++){delete this.injectInto[this.injectedKeys[e]]}this.injectedKeys=[]}},create:function(t){if(!t){return e.create(e.sandbox)}var i=r(t);i.args=i.args||[];i.injectedKeys=[];i.injectInto=t.injectInto;var s,o,u=i.inject({});if(t.properties){for(var a=0,f=t.properties.length;a<f;a++){s=t.properties[a];o=u[s]||s=="sandbox"&&i;n(i,t,s,o)}}else{n(i,t,"sandbox",o)}return i}});e.sandbox.useFakeXMLHttpRequest=e.sandbox.useFakeServer;return e.sandbox}function r(t,n,r){var i=t("./util/core");t("./util/fake_server");t("./util/fake_timers");t("./collection");r.exports=e(i)}var t=typeof module!=="undefined"&&module.exports&&typeof require=="function";var n=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(n){define(r)}else if(t){r(require,module.exports,module)}else if(!sinon){return}else{e(sinon)}})();(function(e){function t(e){function t(t){function r(){var n=e.getConfig(e.config);n.injectInto=n.injectIntoThis&&this||n.injectInto;var r=e.sandbox.create(n);var i,s;var o=false;var u=Array.prototype.slice.call(arguments);if(u.length>0&&typeof u[arguments.length-1]=="function"){var a=u[arguments.length-1];u[arguments.length-1]=function(t){if(t){r.restore();throw i}else{r.verifyAndRestore()}a(t)};o=true}var f=u.concat(r.args);try{s=t.apply(this,f)}catch(l){i=l}if(!o){if(typeof i!=="undefined"){r.restore();throw i}else{r.verifyAndRestore()}}return s}var n=typeof t;if(n!="function"){throw new TypeError("sinon.test needs to wrap a test function, got "+n)}if(t.length){return function(t){return r.apply(this,arguments)}}return r}t.config={injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true};e.test=t;return t}function i(e,n,r){var i=e("./util/core");e("./sandbox");r.exports=t(i)}var n=typeof module!=="undefined"&&module.exports&&typeof require=="function";var r=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(r){define(i)}else if(n){i(require,module.exports,module)}else if(!e){return}else{t(e)}})(typeof sinon=="object"&&sinon||null);(function(e){function t(e,t,n){return function(){if(t){t.apply(this,arguments)}var r,i;try{i=e.apply(this,arguments)}catch(s){r=s}if(n){n.apply(this,arguments)}if(r){throw r}return i}}function n(e){function n(n,r){if(!n||typeof n!="object"){throw new TypeError("sinon.testCase needs an object with test functions")}r=r||"test";var i=new RegExp("^"+r);var s={},o,u,a;var f=n.setUp;var l=n.tearDown;for(o in n){if(n.hasOwnProperty(o)){u=n[o];if(/^(setUp|tearDown)$/.test(o)){continue}if(typeof u=="function"&&i.test(o)){a=u;if(f||l){a=t(u,f,l)}s[o]=e.test(a)}else{s[o]=n[o]}}}return s}e.testCase=n;return n}function s(e,t,r){var i=e("./util/core");e("./test");r.exports=n(i)}var r=typeof module!=="undefined"&&module.exports&&typeof require=="function";var i=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(i){define(s)}else if(r){s(require,module.exports,module)}else if(!e){return}else{n(e)}})(typeof sinon=="object"&&sinon||null);(function(e,t){function r(e){function i(){var e;for(var t=0,n=arguments.length;t<n;++t){e=arguments[t];if(!e){r.fail("fake is not a spy")}if(typeof e!="function"){r.fail(e+" is not a function")}if(typeof e.getCall!="function"){r.fail(e+" is not stubbed")}}}function s(e,n){e=e||t;var i=e.fail||r.fail;i.call(e,n)}function o(e,t,o){if(arguments.length==2){o=t;t=e}r[e]=function(u){i(u);var a=n.call(arguments,1);var f=false;if(typeof t=="function"){f=!t(u)}else{f=typeof u[t]=="function"?!u[t].apply(u,a):!u[t]}if(f){s(this,u.printf.apply(u,[o].concat(a)))}else{r.pass(e)}}}function u(e,t){return!e||/^fail/.test(t)?t:e+t.slice(0,1).toUpperCase()+t.slice(1)}var r;r={failException:"AssertError",fail:function(t){var n=new Error(t);n.name=this.failException||r.failException;throw n},pass:function(t){},callOrder:function(){i.apply(null,arguments);var o="",u="";if(!e.calledInOrder(arguments)){try{o=[].join.call(arguments,", ");var a=n.call(arguments);var f=a.length;while(f){if(!a[--f].called){a.splice(f,1)}}u=e.orderByFirstCall(a).join(", ")}catch(l){}s(this,"expected "+o+" to be "+"called in order but were called as "+u)}else{r.pass("callOrder")}},callCount:function(n,o){i(n);if(n.callCount!=o){var u="expected %n to be called "+e.timesInWords(o)+" but was called %c%C";s(this,n.printf(u))}else{r.pass("callCount")}},expose:function(t,n){if(!t){throw new TypeError("target is null or undefined")}var r=n||{};var i=typeof r.prefix=="undefined"&&"assert"||r.prefix;var s=typeof r.includeFail=="undefined"||!!r.includeFail;for(var o in this){if(o!="expose"&&(s||!/^(fail)/.test(o))){t[u(i,o)]=this[o]}}return t},match:function(n,i){var o=e.match(i);if(o.test(n)){r.pass("match")}else{var u=["expected value to match","    expected = "+e.format(i),"    actual = "+e.format(n)];s(this,u.join("\n"))}}};o("called","expected %n to have been called at least once but was never called");o("notCalled",function(e){return!e.called},"expected %n to not have been called but was called %c%C");o("calledOnce","expected %n to be called once but was called %c%C");o("calledTwice","expected %n to be called twice but was called %c%C");o("calledThrice","expected %n to be called thrice but was called %c%C");o("calledOn","expected %n to be called with %1 as this but was called with %t");o("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t");o("calledWithNew","expected %n to be called with new");o("alwaysCalledWithNew","expected %n to always be called with new");o("calledWith","expected %n to be called with arguments %*%C");o("calledWithMatch","expected %n to be called with match %*%C");o("alwaysCalledWith","expected %n to always be called with arguments %*%C");o("alwaysCalledWithMatch","expected %n to always be called with match %*%C");o("calledWithExactly","expected %n to be called with exact arguments %*%C");o("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C");o("neverCalledWith","expected %n to never be called with arguments %*%C");o("neverCalledWithMatch","expected %n to never be called with match %*%C");o("threw","%n did not throw exception%C");o("alwaysThrew","%n did not always throw exception%C");e.assert=r;return r}function o(e,t,n){var i=e("./util/core");e("./match");n.exports=r(i)}var n=Array.prototype.slice;var i=typeof module!=="undefined"&&module.exports&&typeof require=="function";var s=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(s){define(o)}else if(i){o(require,module.exports,module)}else if(!e){return}else{r(e)}})(typeof sinon=="object"&&sinon||null,typeof window!="undefined"?window:typeof self!="undefined"?self:global);if(typeof sinon=="undefined"){this.sinon={}}(function(e){function n(n){function r(){this.readyState=r.UNSENT;this.requestBody=null;this.requestHeaders={};this.status=0;this.timeout=null;if(typeof r.onCreate=="function"){r.onCreate(this)}}function i(e){if(e.readyState!==r.OPENED){throw new Error("INVALID_STATE_ERR")}if(e.sendFlag){throw new Error("INVALID_STATE_ERR")}}function s(e){if(e.readyState==r.UNSENT){throw new Error("Request not sent")}if(e.readyState==r.DONE){throw new Error("Request done")}}function o(e){if(typeof e!="string"){var t=new Error("Attempted to respond to fake XDomainRequest with "+e+", which is not a string.");t.name="InvalidBodyException";throw t}}n.xdr=t;n.extend(r.prototype,n.EventTarget,{open:function(t,n){this.method=t;this.url=n;this.responseText=null;this.sendFlag=false;this.readyStateChange(r.OPENED)},readyStateChange:function(t){this.readyState=t;var i="";switch(this.readyState){case r.UNSENT:break;case r.OPENED:break;case r.LOADING:if(this.sendFlag){i="onprogress"}break;case r.DONE:if(this.isTimeout){i="ontimeout"}else if(this.errorFlag||this.status<200||this.status>299){i="onerror"}else{i="onload"}break}if(i){if(typeof this[i]=="function"){try{this[i]()}catch(s){n.logError("Fake XHR "+i+" handler",s)}}}},send:function(t){i(this);if(!/^(get|head)$/i.test(this.method)){this.requestBody=t}this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.errorFlag=false;this.sendFlag=true;this.readyStateChange(r.OPENED);if(typeof this.onSend=="function"){this.onSend(this)}},abort:function(){this.aborted=true;this.responseText=null;this.errorFlag=true;if(this.readyState>n.FakeXDomainRequest.UNSENT&&this.sendFlag){this.readyStateChange(n.FakeXDomainRequest.DONE);this.sendFlag=false}},setResponseBody:function(t){s(this);o(t);var n=this.chunkSize||10;var i=0;this.responseText="";do{this.readyStateChange(r.LOADING);this.responseText+=t.substring(i,i+n);i+=n}while(i<t.length);this.readyStateChange(r.DONE)},respond:function(t,n,r){this.status=typeof t=="number"?t:200;this.setResponseBody(r||"")},simulatetimeout:function(){this.status=0;this.isTimeout=true;this.responseText=undefined;this.readyStateChange(r.DONE)}});n.extend(r,{UNSENT:0,OPENED:1,LOADING:3,DONE:4});n.useFakeXDomainRequest=function(){n.FakeXDomainRequest.restore=function(i){if(t.supportsXDR){e.XDomainRequest=t.GlobalXDomainRequest}delete n.FakeXDomainRequest.restore;if(i!==true){delete n.FakeXDomainRequest.onCreate}};if(t.supportsXDR){e.XDomainRequest=n.FakeXDomainRequest}return n.FakeXDomainRequest};n.FakeXDomainRequest=r}function s(e,t,r){var i=e("./core");e("./event");n(i);r.exports=i}var t={XDomainRequest:e.XDomainRequest};t.GlobalXDomainRequest=e.XDomainRequest;t.supportsXDR=typeof t.GlobalXDomainRequest!="undefined";t.workingXDR=t.supportsXDR?t.GlobalXDomainRequest:false;var r=typeof module!=="undefined"&&module.exports&&typeof require=="function";var i=typeof define==="function"&&typeof define.amd==="object"&&define.amd;if(i){define(s)}else if(r){s(require,module.exports,module)}else{n(sinon)}})(this);return sinon}.call(typeof window!="undefined"&&window||{})

stubMeteor = function() {
  var getStub = sinon.stub()
    .withArgs('currentSemester').returns('20151');
  Session = {
    get: getStub,
    set: sinon.stub()
  };
};

